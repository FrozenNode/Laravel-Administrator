/*!
   * Lightweight Colorpicker - jQuery Plugin
   * Provides simple scalable colorpicker
   *
   * Â© 2012 Dmitriy Kubyshkin (http://kubyshkin.ru)
   *
   * Version: 1.0
   * Requires: jQuery v1.7+
   *
   * Dual licensed under the MIT and GPL licenses:
   *   http://www.opensource.org/licenses/mit-license.php
   *   http://www.gnu.org/licenses/gpl.html
   */(function(){var a=typeof WebKitCSSMatrix!="undefined"&&(new WebKitCSSMatrix).m11,b={start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"};Function.prototype.bind||(Function.prototype.bind=function(a){var b=Array.prototype.slice.call(arguments,2),c=this;return function(){return c.apply(a,b.concat(Array.prototype.slice.call(arguments)))}});var c=function(a){var b=a[0].toString(16),c=a[1].toString(16),d=a[2].toString(16);return b.length>1||(b="0"+b),c.length>1||(c="0"+c),d.length>1||(d="0"+d),b+c+d},d=function(a){return a=a.replace("#",""),a.length===3&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]},e=function(a){var b=(a[0]-Math.floor(a[0]))*6,c=b-Math.floor(b),d=a[2]*(1-a[1]),e=a[2]*(1-a[1]*c),f=a[2]*(1-a[1]*(1-c)),g=0,h=0,i=0;switch(Math.floor(b)){case 0:g=a[2]*255+.5,h=f*255+.5,i=d*255+.5;break;case 1:g=e*255+.5,h=a[2]*255+.5,i=d*255+.5;break;case 2:g=d*255+.5,h=a[2]*255+.5,i=f*255+.5;break;case 3:g=d*255+.5,h=e*255+.5,i=a[2]*255+.5;break;case 4:g=f*255+.5,h=d*255+.5,i=a[2]*255+.5;break;case 5:g=a[2]*255+.5,h=d*255+.5,i=e*255+.5}return[Math.floor(g),Math.floor(h),Math.floor(i)]},f=function(a){var b=a[0]/255,c=a[1]/255,d=a[2]/255,e=Math.max(b,c,d),f=Math.min(b,c,d),g,h,i=e,j=e-f;h=e==0?0:j/e;if(e==f)g=0;else{switch(e){case b:g=(c-d)/j+(c<d?6:0);break;case c:g=(d-b)/j+2;break;case d:g=(b-c)/j+4}g/=6}return[g,h,i]},g=function(a){this.dragStart=this.dragStart.bind(this),this.dragMove=this.dragMove.bind(this),this.dragEnd=this.dragEnd.bind(this),this.onChange=this.onChange.bind(this),this.dragging=!1,this.$input=$(a).on("change input",this.onChange),this.$el=$('<div class="lw-colorpicker"/>').html(g.template).on(b.start,function(a){return!1}).on(b.start,".lw-sb, .lw-h",this.dragStart).appendTo(document.body),this.onChange(),this.updatePosition()};g.template='<div class="lw-sb">    <img alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAABCAYAAAAxWXB3AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEFJREFUeNpi/A8EDAwMIMxAgCYkhs4mho9LjBg5euJ/FMj/o7EYpXxamPmPDuFAjbihJyY1nZOSl4jNoxg0QIABAI+56gCQgk6WAAAAAElFTkSuQmCC">    <img alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAEACAYAAAByPhyYAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEFJREFUeNpiYIACRiYQyUQci1gJbFySxPBLkKRkkBBM1FPHNEAS9BAbeIuoLUGTJDBICEpyKJnFA+mFEVYWQIABAG2AAvsKiLR6AAAAAElFTkSuQmCC">    <div class="lw-handle"></div>   </div>   <div class="lw-h">    <img alt="" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAEACAIAAAD9XIvPAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAALxJREFUeNp00tkKhTAMBNB07/3/n7WL7U0hwhDSh8OkKjoEaRN5oggSy5DFUA2/y4wKZJH3oyQibVp+kfMv9zumGJDdyKMZiaxr+nq/GMoE3JMcnY1uT4H3GlmCzIYCqpHVOFvPfjJkgvx6RC65uJ9bvOdXTDBAh0QNUs8W69luGAr24u1ux6slH3jDESQli2IkqpdZn7Oakf429KLNXbm2pymGZJe5iwZ5PGp+1Pxc7jWlKwPwD7sD/QUYAMWijuyJPChnAAAAAElFTkSuQmCC">    <div class="lw-handle"></div>   </div>',g.prototype.destroy=function(){this.$el.remove()},g.prototype.dragStart=function(a){if(a.which!==1)return;var c=$(a.currentTarget),d=c.offset();return this.area="h",this.areaOffset=d,this.areaDimensions={width:c.width(),height:c.height()},this.dragging=c.find(".lw-handle"),$(document.body).on(b.move,this.dragMove),$(document.body).on(b.end,this.dragEnd),c.hasClass("lw-sb")&&(this.area="sb"),this.dragMove(a),!1},g.prototype.dragMove=function(a){if(!this.dragging)return;var b={top:a.pageY-this.areaOffset.top,left:0};this.area==="sb"&&(b.left=a.pageX-this.areaOffset.left),b.left>=0||(b.left=0),b.top>=0||(b.top=0),b.left<=this.areaDimensions.width||(b.left=this.areaDimensions.width),b.top<=this.areaDimensions.height||(b.top=this.areaDimensions.height),this.setPosition(this.dragging,b);var d=this.getHSB();return this.updateInput("#"+c(e(d))),d[1]=d[2]=1,this.$el.find(".lw-sb").css("background","#"+c(e(d))),!1},g.prototype.dragEnd=function(a){if(!this.dragging)return;return this.dragging=null,$(document.body).unbind(b.move,this.dragMove),$(document.body).unbind(b.end,this.dragEnd),!1},g.prototype.onChange=function(){if(this.dragging)return;var a=this.$input.val();a.match(/^\#?[0-9a-fA-F]{3}([0-9a-fA-F]{3})?$/)&&this.setHex(a)},g.prototype.getHex=function(){return c(this.getRGB())},g.prototype.setHex=function(a){this.setRGB(d(a))},g.prototype.getRGB=function(){return e(this.getHSB())},g.prototype.setRGB=function(a){this.setHSB(f(a))},g.prototype.getHSB=function(){var a=this.$el.find(".lw-sb"),b=this.$el.find(".lw-h"),c=this.getPosition(a.find(".lw-handle")),d=this.getPosition(b.find(".lw-handle"));return[1-d.top/b.height(),c.left/a.width(),1-c.top/a.height()]},g.prototype.setHSB=function(a){var b=this.$el.find(".lw-sb"),d=this.$el.find(".lw-h");this.setPosition(b.find(".lw-handle"),{top:Math.floor((1-a[2])*b.height()),left:Math.floor(a[1]*b.width())}),this.setPosition(d.find(".lw-handle"),{top:Math.floor((1-a[0])*d.height()),left:0}),a[1]=a[2]=1,this.$el.find(".lw-sb").css("background","#"+c(e(a)))},g.prototype.updateInput=function(a){this.$input.val(a).trigger("change")},g.prototype.updatePosition=function(){var a,b,c,d,e;a=this.$input.offset(),e=this.$el.outerWidth(),d=this.$el.outerHeight(),b=a.left,$("body").width()>b+e?this.$el.css({left:b}):a.left>e?this.$el.css({left:$("body").width()-e-31}):this.$el.css({left:b}),this.$el.removeClass("lw-opposite-vertical"),c=a.top+this.$input.outerHeight(),$(document).height()>c+d?this.$el.css({top:c}):a.top>d?(this.$el.css({top:a.top-d}),this.$el.addClass("lw-opposite-vertical")):this.$el.css({top:c})},a?(g.prototype.getPosition=function(a){var b=a.get(0).style.webkitTransform,c={top:0,left:0};return b&&(b=b.split("(")[1].split(","),c.left=parseInt(b[0]),c.top=parseInt(b[1])),c},g.prototype.setPosition=function(a,b){a.get(0).style.webkitTransform="translate3d("+b.left+"px,"+b.top+"px,0)"}):(g.prototype.getPosition=function(a){return a.position()},g.prototype.setPosition=function(a,b){a.css(b)}),$(function(){$(document).on("focus",'[data-type="color"]',function(a){var b=$(a.target),c=new g(b),d=function(){c.destroy(),b.off("blur",d)};b.on("blur",d)})})})();